---
import Stream from "./Stream.astro"
import Article from "./Article.astro"
import contentful from 'contentful'

const client = contentful.createClient({
  space: process.env.CONTENTFUL_SPACE_ID || import.meta.env.CONTENTFUL_SPACE_ID,
  accessToken: process.env.CONTENTFUL_CONTENT_DELIVERY || import.meta.env.CONTENTFUL_CONTENT_DELIVERY,
});

let articles = await client.getEntries({
  content_type: 'articlePost'
  }).then(entries => {
    return entries.items
    }
).catch(err => {
  console.log(err)
});
const {size = "small", style} = Astro.props;

const months = ['January', 'February',
'March','April','May','June','July','August','September','October','November','December',]
const descriptionCutoff = 60
---
<Stream title="External Articles" size={size} >
{articles.map(post => {
    let formatDate =  new Date(post.fields.date)
    return (
      <Article 
        href={`${post.fields.url}`} 
        imgSrc={post.fields.thumbnail.fields.file.url} 
        imgAlt={post.fields.thumbnail.fields.description}
        articleTitle={post.fields.articleTitle}
        description={post.fields.url.length > descriptionCutoff ? post.fields.url.split('').splice(0, descriptionCutoff).join('').concat('...') : post.fields.url}
        author={post.fields.author} 
        date={`${months[formatDate.getMonth()]} ${formatDate.getDate()}, ${formatDate.getFullYear()}`}
      />
    )
  }
)}
</Stream>
